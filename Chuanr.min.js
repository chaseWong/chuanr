!function(){var a,b,c=new Function("return this")(),d=function(a){var b=a();"undefined"!=typeof module&&(module.exports=b),c.define&&c.define(function(){return b}),c.Chuanr=b};!function(){function c(a,b){var c,d,e=0;for(a=a.split("/"),b=b.split("/"),"."==b[0]||".."==b[0]?(a.pop(),c=a.concat(b)):c=b,d=c.length;d--;)"."==c[d]?c.splice(d,1):".."==c[d]?e++:e>0&&(c.splice(d,2),e--);return c.join("/")}var d={},e=this;b=function(a,b,c){d[a]={p:a,d:b,f:c}},b.amd=!0,a=function(b,f){var g,h,i,j=this,k=[];(null==j||j===e)&&(j={p:"_NE_"}),"string"==typeof b&&null==f&&(b=[b]);for(var l=0;l<b.length;l++){if(h=b[l],i=c(j.p,h),g="require"==i?{p:"_NE_",d:[],f:function(){return a}}:d[i],!g)throw"module not found";k.push(a.call(g,g.d,g.f))}return k.push(a,{}),f?f.apply(e,k):k[0]}}(),b("../lib/amdshim/amdshim",function(){}),b("PatternConstant",[],function(){return{MODE_CONSTANT:1,MODE_FUNCTION:2,MODE_PARAMETER:4,TYPE_POSITIVE:0,TYPE_NEGATIVE:1,TYPE_REGEXP:2,TYPE_PASSIVE:4}}),b("util",[],function(){var a={},b="undefined"!=typeof navigator?navigator.userAgent:null,c=/iphone/i.test(b);return a.addListener=function(a,b,c){return a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent("on"+b,c)},a.removeListener=function(a,b,c){return a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent("on"+b,c)},a.preventDefault=function(a){return a.preventDefault?a.preventDefault():a.returnValue=!1},a.isDelKey=function(a){return 46===a||c&&127===a},a.isBackSpaceKey=function(a){return 8===a},a.isSpecialKey=function(a){var b={9:"tab",13:"enter",35:"end",36:"home",37:"leftarrow",38:"uparrow",39:"rightarrow",40:"downarrow",116:"F5"};return b[a]},a.isModifier=function(a){return a.ctrlKey||a.altKey||a.metaKey},a.isMovementKeyCode=function(a){return a>=35&&40>=a||9==a?!0:!1},a.hasBit=function(a,b){return 0==b?1!=(1&a):(a&b)==b},a}),b("../lib/boe/src/boe/global",[],function(){return Function("return this")()}),b("../lib/boe/src/boe/Function/bind",["../global"],function(a){var b=a.Function.prototype,c=a.Array.prototype;return b.bind||function(a){var b=c.slice,d=this,e=b.call(arguments);return e.shift(),function f(){return this instanceof f&&(a=this),d.apply(a,e.concat(b.call(arguments)))}}}),b("../lib/boe/src/boe/util",["./global","./Function/bind"],function(a,b){var c=a.Object.prototype,d=a.Array.prototype,e=a.Function.prototype,f="function",g={mixinAsStatic:function(a,c){for(var d in c)c.hasOwnProperty(d)&&(a[d]=b.call(e.call,c[d]));return a},type:function(a){var b=c.toString.call(a),d=b.indexOf("]");return b.substring(8,d)},mixin:function(a,b,c){null==b&&(b=a,a={});for(var d in b)b.hasOwnProperty(d)&&(a[d]=typeof c==f?c(d,b[d]):b[d]);return a},slice:function(a){return d.slice.call(a)},g:a};return g}),b("../lib/boe/src/boe/String/trimLeft",["../util"],function(a){return function(b){var c;"String"==a.type(b)?(c=b.charCodeAt(0).toString(16),b=c.length<=2?"\\x"+c:"\\u"+c):b instanceof RegExp||(b="\\s");var d=new RegExp("(^"+b+"*)","g");return this.replace(d,"")}}),b("../lib/boe/src/boe/String/trimRight",["../util"],function(a){return function(b){var c;"String"==a.type(b)?(c=b.charCodeAt(0).toString(16),b=c.length<=2?"\\x"+c:"\\u"+c):b instanceof RegExp||(b="\\s");var d=new RegExp("("+b+"*$)","g");return this.replace(d,"")}}),b("Formatter",["./PatternConstant","./util","../lib/boe/src/boe/String/trimLeft","../lib/boe/src/boe/String/trimRight"],function(a,b,c,d){function e(){for(var c,d,e,f,g=!1,h=this._cache,i=!1,j=0;j<this.patterns.length;j++)if(c=this.patterns[j],!b.hasBit(c.type,a.TYPE_POSITIVE)&&!b.hasBit(c.type,a.TYPE_PASSIVE)&&(d=c.apply(h))&&d.matched){f=c,e=d,i=!0;break}for(var j=0;j<this.patterns.length&&i===!1;j++)if(c=this.patterns[j],!b.hasBit(c.type,a.TYPE_NEGATIVE)&&(d=c.apply(h))){if(d.matched){e=d,f=c,g=!0;break}(null==e||d.counts.matched>e.counts.matched)&&(e=d,f=c)}return f&&e?(this._current={pattern:f,result:e,input:h},this._current):null}function f(a){if(null==a||a.length>>>0<=0)throw g;this._cache="",this._current=null,this.patterns=a,this._undo=[]}var g="No pattern specified",h=f.prototype;return h.input=function(a){var b,c=this._cache,d="";"string"==typeof a&&(a={key:0,"char":a.charCodeAt(0),del:!1,back:!1,caret:{begin:c.length,end:c.length}}),b={begin:a.caret.begin,end:a.caret.end},a.caret.begin==a.caret.end&&(a.del?b.end+=1:a.back&&(b.begin-=1)),null!=a["char"]&&(d=String.fromCharCode(a["char"])),c=c.substring(0,b.begin)+d+c.substring(b.end,c.length),this._undo.push(this._cache),this._cache=c},h.output=function(){return e.call(this)},h.undo=function(){return this._undo.length<=0?null:(this._cache=this._undo.pop(),e.call(this))},h.extract=function(e){var f,g,h=null;if(this._current&&this._current.pattern)try{h=this._current.pattern.extract(e),h.pattern=this._current.pattern}catch(i){}for(var j=this.patterns.length;j--;)if(g=this.patterns[j],!b.hasBit(g.type,a.TYPE_NEGATIVE)){try{f=g.extract(c.call(d.call(e,g.config.placeholder.empty),g.config.placeholder.empty))}catch(i){continue}(null==h||f.length>h.length)&&(h=f,h.pattern=g)}return h},h.index=function(){return this._current.pattern.index()},h.reset=function(a){return null==a&&(a=""),this._undo.push(this._cache),this._cache=a,this._current=null,e.call(this)},h.isIntact=function(c){for(var d,e=!1,f=this.patterns.length;f--;)if(d=this.patterns[f],b.hasBit(d.type,a.TYPE_PASSIVE)&&(result=d.apply(c),0==result.legitimate))return!1;for(var f=this.patterns.length;f--;)if(d=this.patterns[f],b.hasBit(d.type,a.TYPE_POSITIVE)&&(e=!0,result=d.apply(c,!0),1==result.legitimate))return!0;return!e},f}),b("PatternFunction/digit",[],function(){function a(a){return null==a||null==a.prev||1!=d.test(a.prev)?!0:!1}var b="Not a correct parameter format",c="Expect the range to be 0-9",d=/[0-9]/,e=/[^0-9\-]/,f=function(d,f,g){if("?"==f){if(""==d||d===g.pattern.config.placeholder.empty)return!0;f=""}if("="==f)return a(g)?!1:d==g.prev;if("+"==f.charAt(0)||"-"==f.charAt(0)){if(a(g))return!1;if(1==f.length&&(f+="1"),Math.abs(f>>0)>=10)throw new Error(c);return d==1*g.prev+(f>>0)}if((null==f||0==f&&"0"!==f)&&(f="0-9"),e.test(f))throw new Error(b);return new RegExp("^["+f+"]$").test(d)};return f}),b("PatternFunction/alphabet",[],function(){function a(a){return null==a||null==a.prev||1!=e.test(a.prev)?!0:!1}var b="Not a correct parameter format",c="Expect the range to be a-zA-Z",d="a-zA-Z",e=new RegExp("["+d+"]"),f=new RegExp("[^"+d+"-]"),g=function(e,g,h){if("?"==g){if(""==e||" "==e)return!0;g=""}if("="==g)return a(h)?!1:e==h.prev;if("+"==g.charAt(0)||"-"==g.charAt(0)){if(a(h))return!1;if(1==g.length&&(g+="1"),Math.abs(g>>0)>=10)throw new Error(c);return e.charCodeAt(0)==(1*h.prev+(g>>0)).charCodeAt(0)}if((null==g||0==g&&"0"!==g)&&(g=d),f.test(g))throw new Error(b);return new RegExp("^["+g+"]$").test(e)};return g}),b("PatternFunction/duplicate",[],function(){var a=function(a,b,c){var d,e,f,g=c.index>>>0,h=g,i=c.pattern.items,j=[];if("?"==b&&""==a)return!0;for(var k=i.length;k--;)2==i[k].type&&j.unshift(i[k]);for(var k=j.length;k--;)if(d=j[k],k==g&&(f=c.pattern.constructor.functions[d.value]),k==h-1){if(e=c.pattern.constructor.functions[d.value],f!==e)break;h--}if(null==e||f==e)throw new Error("No previous function");var l={};for(var m in c)c.hasOwnProperty(m)&&(l[m]=c[m]);return l.index=k,e.call(this,a,d.param,l)};return a}),b("PatternFunction/never",[],function(){var a=function(a,b,c){return""==b||null==b||""===a||a===c.pattern.config.placeholder.empty?!1:"="==b?!(c.prev===a):!(a===b)};return a}),b("PatternFunction/everything",[],function(){return function(a,b){return null==b||""==b||0==b?!0:new RegExp("^["+b+"]$").test(a)}}),b("PatternFunction/luhn",["./digit"],function(a){return function(b,c,d){var e=d.input;if(0==a(b,"",d))return!1;for(var f=0,g=!1,h=0,i=e.length-1;i>=0;i--)h=e.charAt(i)>>0,g&&(h*=2,h>9&&(h-=9)),f+=h,g=!g;return f%10===0}}),b("../lib/boe/src/boe/Object/clone",["../util","../global"],function(a,b){function c(b){var i;if(h in this)return this[h];g.push(this),i=typeof this==d?window.eval("true?("+f.toString.call(this)+"):false"):"Array"==a.type(this)?[]:{},this[h]=i;for(var j in this)if(0!=this.hasOwnProperty(j)&&j!=h){var k=this[j];i[j]=!b||typeof k!=e&&typeof k!=d?k:c.call(k,b)}if(g.pop()!=this)throw"boe.Object.shadow: stack corrupted.";return delete this[h],i}var d="function",e="object",f=b.Function.prototype,g=[],h="__boeObjectClone_Traversed";return c}),b("PatternIndexQuery",["./PatternConstant"],function(a){function b(){var a,b,c,f=this._query,g=this._target,h=this._pattern.items;if(null==f||null==g)return this;if(f["function"]&&null!=f["function"].index&&"pattern"==g){a=-1;for(var i=0;i<h.length;i++)if(b=h[i],b.type==d&&(a++,c=i,a==f["function"].index))return i;return f["function"].index==a+1?c+1:-1}if(f.pattern&&null!=f.pattern.index&&"function"==g){if(a=0,f.pattern.index<0)return-1;for(var i=0;i<h.length&&f.pattern.index>0;i++)if(b=h[i],b.type==d&&a++,i==f.pattern.index-1)return a;return a}throw e}function c(a){this._pattern=a,this._target="pattern"}var d=(a.MODE_CONSTANT,a.MODE_FUNCTION),e=(a.MODE_PARAMETER,"Parameter not acceptable."),f=c.prototype;return f.by=function(a){return this._query=a,b.call(this)},f.of=function(a){return this._target=a,this},c}),b("PatternApplicationResult",[],function(){function a(a){this.result=a.result||"",this.matched=a.matched||!1,this.legitimate=("boolean"==typeof a.legitimate?a.legitimate:a.matched)||!1,this.counts={total:a.counts&&a.counts.total||0,matched:a.counts&&a.counts.matched||0}}return a.prototype.toString=function(){return this.result},a}),b("Pattern",["./util","./PatternFunction/digit","./PatternFunction/alphabet","./PatternFunction/duplicate","./PatternFunction/never","./PatternFunction/everything","./PatternFunction/luhn","../lib/boe/src/boe/Object/clone","../lib/boe/src/boe/util","./PatternIndexQuery","./PatternConstant","./PatternApplicationResult"],function(a,b,c,d,e,f,g,h,i,j,k,l){function m(a,b){return I+": "+a+":"+b}function n(a,b){return J+": "+a+":"+b}function o(){return this.result}function p(a){if(a==v)return w;if(a==w)return v;if(a==x)return y;if(a==y)return x;throw new Error(K)}function q(a){for(var b,c,d=this,e=F,f=[],g=0;g<a.length;g++)if(b=a.charAt(g),0===g&&a.charAt(g+1)==z)if("-"==b)d.type|=C;else{if("~"==b)return d.type|=C,d.type|=D,r.call(d,a.substr(2,a.length-2));"_"==b&&(d.type|=C,d.type|=E)}else if(1>=g&&b==z);else if(e==F&&b==v)f.push({"char":b,mode:e}),e=G;else if(e==G&&b==w&&f[f.length-1][u]==v)c=f.pop(),e=c.mode;else if(e==G&&b==x)f.push({"char":b,mode:e}),e=H;else if(e==H&&b==y&&f[f.length-1][u]==x)c=f.pop(),e=c.mode;else if(e==F)d.items.push({type:e,value:b});else if(e==G)d.items.push({type:e,value:b,param:""});else{var h=d.items[d.items.length-1];if(h.type!=G)throw new Error(m("Expect a function pattern",g-1));h.param+=b}if(f.length>0)throw new Error(m("Expect a '"+p(f[f.length-1][u])+"'",g-1))}function r(a){for(var b,c=!1,d="",e="",f=0;f<a.length;f++)b=a.charAt(f),c?e+=b:b===A?c=!0:"\\"===b?(d+=a.charAt(f+1)===A?A:b+a.charAt(f+1),f++):d+=b;this.regExp=new RegExp(d,e)}function s(a){return function(c){return b(c,a+"")}}function t(a,b){this.config=h.call(M,!0),i.mixin(this.config,b),this.items=[],this.pattern=a,this.type=B,this._query=null,this.regExp=null,q.call(this,a)}var u="char",v="{",w="}",x="(",y=")",z="|",A="/",B=k.TYPE_POSITIVE,C=k.TYPE_NEGATIVE,D=k.TYPE_REGEXP,E=k.TYPE_PASSIVE,F=k.MODE_CONSTANT,G=k.MODE_FUNCTION,H=k.MODE_PARAMETER,I="Syntax error",J="Runtime error",K="Not a tag.",L="Not a formatted string.",M={placeholder:{empty:" "}},N=t.prototype;N.apply=function(b,c){var d,e,f,g,i,j,k,m,o=[],p="",q=!0,r=0;if(f=b.toString(),a.hasBit(this.type,C)&&(c=!0,a.hasBit(this.type,D)))return q=this.regExp.test(b),new l({matched:q,legitimate:!q});for(g=h.call(this.items,!0),d=0;d<g.length;d++)i=g[d],i.type==G&&o.push(i);for(e=c?o.length:f.length,b.length>o.length&&(q=!1),d=0;e>d&&d<o.length;d++)if(i=o[d],m=f.charAt(d),i.type==G){if(j=t.functions[i.value],null==j)throw new Error(n('Function "'+i.value+'"" was not available.',d));k={pattern:this,index:d,prev:f.charAt(d-1),input:f};try{if(j.call(null,m,i.param,k)===!1){q=!1;break}}catch(s){throw new Error(n(s.message,d))}r++,i.value=m,i.type=F}for(d=0;d<g.length;d++)i=g[d],p+=i.type==F?i.value:this.config.placeholder.empty;return new l({result:p,matched:q,legitimate:a.hasBit(this.type,B)?q:!q,counts:{total:e,matched:r}})},N.extract=function(a){if(a.length>this.items.length)throw L;var b,c,d,e,f=[],g=this.items,h="",i=0;f.toString=function(){return this.join("")};for(var j=0;j<a.length;j++)if(b=g[j],e=a.charAt(j),b.type==G){if(c=t.functions[b.value],null==c)throw L;if(e==this.config.placeholder.empty)continue;if(d={pattern:this,index:i,prev:h,input:f+e},c.call(null,e,b.param,d)===!1)throw L;f.push({result:e,index:{formatted:j,original:f.length},toString:o}),h=e,i++}else{if(b.type!=F)throw L;if(e!=b.value)throw L}return f},N.index=function(a){var b=new j(this,a);return b},N.toString=function(){return this.pattern},t.functions={d:b,a:c,x:d,n:e,"?":function(a,b,c){return d.call(this,a,"?",c)},"*":f,l:g,L:function(a,b,c){return!g.call(this,a,b,c)}};for(var O=10;O--;)t.functions[O]=s(O);return t.parse=function(a,b){var c=new t(a,b);return c},t}),b("caret",[],function(){var a={};return a.get=function(a){if("number"==typeof a.selectionStart)return{begin:a.selectionStart,end:a.selectionEnd};var b=document.selection.createRange();if(b&&b.parentElement()==a){var c=a.createTextRange(),d=a.createTextRange(),e=a.value.length;return c.moveToBookmark(b.getBookmark()),d.collapse(!1),c.compareEndPoints("StartToEnd",d)>-1?{begin:e,end:e}:{begin:-c.moveStart("character",-e),end:-c.moveEnd("character",-e)}}return{begin:0,end:0}},a.set=function(a,b){if(a.setSelectionRange)a.focus(),a.setSelectionRange(b,b);else if(a.createTextRange){var c=a.createTextRange();c.collapse(!0),c.moveEnd("character",b),c.moveStart("character",b),c.select()}},a}),b("differ",[],function(){var a={diff:function(a,b){var c,d,e,f,g,h,i,j=-1,k=-2,l=0;for(a.length>b.length?(h=a,i=b):(h=b,i=a,l=1),d=0;d<h.length;d++)if(c=h.charAt(d),c!=i.charAt(d)){j=d;break}for(d=h.length;d--;)if(c=h.charAt(d),j>=d||c!=i.charAt(i.length-(h.length-d))){k=d;break}if(f={begin:j,end:k+1},g={begin:j,end:i.length-(h.length-k)+1},e={deletion:{text:h.substring(f.begin,f.end),caret:f},insertion:{text:i.substring(g.begin,g.end),caret:g}},l){var m=e.deletion;e.deletion=e.insertion,e.insertion=m}return e}};return a}),b("../lib/boe/src/boe/String/trim",["../global","./trimLeft","./trimRight"],function(a,b,c){var d=a.String.prototype;return d.trim||function(){var a=b.call(this);return a=c.call(a)}}),b("../lib/cogs/src/cogs/noop",[],function(){return function(){}}),b("../lib/cogs/src/cogs/observable",["./noop"],function(a){function b(){this.ref=null,this.next=null}function c(){return new b}function d(a){if("[object function]"!==Object.prototype.toString.call(a).toLowerCase())throw new Error("hookee is not a function")}function e(a){return d(a),this.cur.next=c(),this.cur=this.cur.next,this.cur.ref=a,!0}function f(a){d(a);for(var b=this.head,c=null;null!=b.next;)if(c=b,b=b.next,b.ref===a||null==a)return c.next=b.next,null==b.next&&(this.cur=c),b.ref=null,!0;return!1}function g(a){var b=this,c=function(){f.call(b,c),a.apply(this,arguments)};e.call(b,c)}function h(){for(var a=Array.prototype.slice.call(arguments,1),b=arguments[0],c=this.head,d=null,e=null,f=null;null!=c.next;)if(d=c,c=c.next,null!=c.ref){e=null;try{e=c.ref.apply(b,a)}catch(g){setTimeout(function(){throw g},0)}null!=e&&(f=e)}return f}function i(b){var d=b?b:function(){return d.invoke.apply(this,arguments)};return d.head=c(),d.head.ref=a,d.cur=d.head,d.hook=e,d.once=g,d.unhook=f,d.invoke=function(){var a=Array.prototype.slice.call(arguments);a.unshift(this),h.apply(d,a)},d}return i.EventLinkBox=b,i}),b("../lib/cogs/src/cogs/event",["./observable"],function(a){function b(){var b=a();b.onHook=a(),b.onUnhook=a();var c=b.hook,d=b.once;b.hook=function(a){return b.onHook(this,a)===!1?!1:c.apply(this,arguments)},b.once=function(a){return b.onHook(this,a)===!1?!1:d.apply(this,arguments)};var e=b.unhook;return b.unhook=function(a){return b.onUnhook(this,a)===!1?!1:e.apply(this,arguments)},b}function c(a,c){var d=a.charAt(0).toUpperCase()+a.substr(1),e=this[f+d];if(e||(e=b(),this[f+d]=e),!e.hook)throw"The member name '"+a+"' is occupied.";e.hook(c)}function d(b,c){if(b){var e=b.charAt(0).toUpperCase()+b.substr(1),g=this[f+e];if(g){if(!g.unhook)throw"The member name '"+b+"' might be over written.";g.unhook(c)}}else for(var h in this)0==h.indexOf(f)&&this[h].head instanceof a.EventLinkBox&&d(h.substr(2))}function e(a){var b,c=[a.charAt(0).toUpperCase(),a.substr(1)].join(""),d=this[f+c];d&&(b=Array.prototype.slice.call(arguments,1),d.apply(this,b))}var f="on";return b.onFunc=c,b.offFunc=d,b.emitFunc=e,b}),b("../lib/cogs/src/cogs/emittable",["./event"],function(a){function b(b){return b.on=a.onFunc,b.off=a.offFunc,b.emit=a.emitFunc,b}return b(b.prototype),b}),function(a,c){"function"==typeof b&&b.amd?b("../lib/xinput/XInput",[],function(){return a.returnExportsGlobal=c()}):"object"==typeof exports?module.exports=c():a.XInput=c()}(this,function(){var a=Function("return this")(),b=function(a){var b=a.Function.prototype,c=a.Array.prototype;return b.bind||function(a){var b=c.slice,d=this,e=b.call(arguments);return e.shift(),function f(){return this instanceof f&&(a=this),d.apply(a,e.concat(b.call(arguments)))}}}(a),c=function(a){function b(a){var b=this;i in window.event&&null!=window.event[i]&&""!==window.event[i]&&"value"!==window.event[i]||b._el.value!=b._old&&(b._old=b._el.value,b.oninput(a))}function c(){document.attachEvent("onselectionchange",this._onchange)}function d(){document.detachEvent("onselectionchange",this._onchange)}function e(){this.oninput()}function f(){this._old="",this._el=null,this._onchange=a.call(b,this),this._onfocus=a.call(c,this),this._onblur=a.call(d,this),this._oninput=a.call(e,this),this.oninput=function(){}}var g="input",h="change",i="propertyName",j=function(){function a(a){if(a.setAttribute("oninput","return"),"function"==typeof a.oninput)return!0;try{var b=document.createEvent("KeyboardEvent"),c=!1,d=function(a){c=!0,a.preventDefault(),a.stopPropagation()};return b.initKeyEvent("keypress",!0,!0,window,!1,!1,!1,!1,0,"e".charCodeAt(0)),document.body.appendChild(a),a.addEventListener(g,d,!1),a.focus(),a.dispatchEvent(b),a.removeEventListener(g,d,!1),document.body.removeChild(a),c}catch(e){}}var b=document.createElement(g);return"oninput"in b||a(b)}(),k=f.prototype;return k.trigger=function(){return this._onchange()},k.sync=function(){this._old=this._el.value},k.observe=function(a){if(null==a||a.tagName.toLowerCase()!=g)throw"Target input element must be specified.";var b=this;if(b._el=a,a.attachEvent)b._old=a.value,a.attachEvent("onpropertychange",b._onchange),a.attachEvent("onfocus",b._onfocus),a.attachEvent("onblur",b._onblur),a.attachEvent("onkeypress",b._onchange),a.attachEvent("onkeyup",b._onchange);else{if(!j)throw"Something wrong, should never goes to here.";a.addEventListener(g,b._onchange,!1),a.addEventListener(h,b._onchange,!1)}},k.neglect=function(){var a=this,b=a._el;b.attachEvent?(b.detachEvent("onpropertychange",a._onchange),b.detachEvent("onfocus",a._onfocus),b.detachEvent("onblur",a._onblur),b.detachEvent("onkeypress",a._onchange),b.detachEvent("onkeyup",a._onchange)):(b.removeEventListener(g,a._onchange),b.removeEventListener(h,a._onchange))},k.dispose=function(){var a=this;a.neglect(),a._el=null},f}(b);return c}),b("Chuanr",["./Formatter","./Pattern","./PatternConstant","./PatternApplicationResult","./util","./caret","./differ","../lib/boe/src/boe/Function/bind","../lib/boe/src/boe/String/trim","../lib/boe/src/boe/Object/clone","../lib/boe/src/boe/util","../lib/cogs/src/cogs/emittable","../lib/cogs/src/cogs/event","../lib/xinput/XInput"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(a,b){var c,d;try{d=this.formatter.extract(a),null!=d&&(c=i.call(d+""))}catch(e){c=null}return b&&null!=c&&(b.begin=this.formatter.index().of("function").by({pattern:{index:b.begin}}),b.end=this.formatter.index().of("function").by({pattern:{index:b.end}}),(b.begin<0||b.begin>c.length)&&(b.begin=c.length),(b.end<0||b.end>c.length)&&(b.end=c.length)),0==c&&(this._isFormatted=!1),c}function p(a,b){var d,e,f,h,i,j,k,l,m=!1;return d=this._untouched?this._untouched.result+"":"",differ=g.diff(d,a),extraction=this.formatter.extract(d),null==extraction?e=this.formatter.extract(a):(f=extraction+"",isSpaceDeletion=differ.insertion.caret.begin==differ.insertion.caret.end&&b.begin<extraction.pattern.items.length&&extraction.pattern.items[b.begin].type==c.MODE_FUNCTION&&differ.deletion.text==this.config.placeholder.empty,m=differ.insertion.caret.begin==differ.insertion.caret.end&&differ.deletion.text.length>0&&extraction.pattern.items[b.begin].type==c.MODE_CONSTANT,h=extraction.pattern.index().of("function").by({pattern:{index:differ.deletion.caret.begin}}),i=extraction.pattern.index().of("function").by({pattern:{index:differ.deletion.caret.end}}),(isSpaceDeletion||m)&&(h=extraction.pattern.index().of("function").by({pattern:{index:b.begin}})-(m?1:0)),h>f.length-1&&(h=f.length,i=h),j=f.substring(0,h),k=f.substring(i,f.length+1),a=j+differ.insertion.text+k,null!=b&&(isSpaceDeletion||m?(b.begin=h,b.end=b.begin,b.type=2):(l=i+differ.insertion.text.length-differ.deletion.text.length,l>=0&&(b.begin=l,b.end=l,b.type=2))),e=a)}function q(a,b,c){var d;return d=o.call(this,this._el.value,null),null==d?(d=a.replace(/\W/g,""),0!=d&&(differ=g.diff(this._untouched?i.call(this._untouched.result+""):"",a),a=i.call(d))):(a=i.call(d),c.type=1),a}function r(a){return 1==this._requireHandleKeyUp&&this._keyCode==a.keyCode?void e.preventDefault(a):void 0}function s(a){null==a&&(a=1),u.call(this,a)}function t(a){var b=this,c=!0;a+="";for(var d=a.length;d--;)if(a.charAt(d)!=this.config.placeholder.empty){c=!1;break}if(c)this._el.value="";else{if(this._el.value==a)return!0;this._el.value=a}b.oninput.sync()}function u(){var a,b=this;return b.oninput.neglect(),a=w.apply(b,arguments),b.oninput.observe(b._el),a}function v(a){var b=this;b._untouched=new d({result:a})}function w(a){var b,c,d,e=this,g={begin:0,end:0,type:0},h=!1;if(d=e._el.value,g=A?A:f.get(e._el),g.type=1,c=p.call(e,d,g),b=e.formatter.reset(c),b&&b.result.legitimate?d=c:d!=c&&(b=e.formatter.reset(d),b&&b.result.legitimate&&(0!=e._isFormatted||0==e._el.value&&"0"!==e._el.value||0!=g.begin||(g.begin=i.call(e._el.value).length,g.end=g.begin),g.type=2)),b&&0==b.result.legitimate&&1==e.config.speculation.batchinput&&(d=q.call(e,d,b,g),b=e.formatter.reset(d)),null==b)return void v.call(e,d);for(;0==b.result.legitimate;){if(0==h&&(h=b),b=e.formatter.undo(),null==b){t.call(e,e._untouched&&e._untouched.result||"");break}g.begin=o.call(e,b.result.toString(),null).length,g.end=g.begin,g.type=2}if(null==b)return void v.call(e,e._untouched&&e._untouched.result||"");e._untouched=b;var j=t.call(e,b.result);(1==a&&null!=A&&j!==!0||2==a)&&(2===g.type?g.begin=e.formatter.index().of("pattern").by({"function":{index:g.begin}}):1===g.type&&(g.begin=e.formatter.index().of("pattern").by({"function":{index:b.input.length}})),A=g,f.set(e._el,g.begin),setTimeout(function(){f.get(e._el)!=g.begin&&f.set(e._el,g.begin),A=!1})),e._isFormatted=0!=b.result?!0:!1,h?e.onPrevented.invoke(h):e.onResumed.invoke(b)}function x(a){var b=this;b.patterns=[],b.passives=[],b.formatter=null,b.oninput=null,b.config=j.call(z,!0),k.mixin(b.config,a,function(a,c){return k.mixin(b.config[a]||{},c)}),b._el=null,b._untouched=null,b._isFormatted=!1,b._onKeyDown=h.call(r,b),b._onFocus=h.call(s,b,2),b.onPrevented=m(),b.onResumed=m(),l(b)}var y={Formatter:a,Pattern:b,InputObserver:n},z={placeholder:{empty:" ",always:!1},speculation:{batchinput:!0}},A=!1,B=x.prototype;return B.roast=function(a,b){var c;if(null==a||"INPUT"!=a.tagName.toUpperCase())throw"Target input element must be specified.";this._el=a;for(var d=0;d<b.length;d++)c=b[d],null!=c&&0!=c&&this.patterns.push(y.Pattern.parse(c,this.config));this.formatter=new y.Formatter(this.patterns),this.oninput=new n,this.oninput.observe(a),this.oninput.oninput=h.call(s,this,1),e.addListener(a,"keydown",this._onKeyDown),e.addListener(a,"focus",this._onFocus),(""!=this._el.value||this.config.placeholder.always===!0)&&s.call(this,document.activeElement===a?1:0)},B.dispose=function(){this.oninput.dispose(),e.removeListener(this._el,"keydown",this._onKeyDown),e.removeListener(this._el,"focus",this._onFocus)},B.intact=function(){return this.formatter.isIntact(this._untouched&&this._untouched.input||this._el.value)},x.setting=y,x}),d(function(){return a("Chuanr")})}();