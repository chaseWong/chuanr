<!DOCTYPE HTML>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <title>Chuanr Testing</title>
    <style type="text/css">
    input 
    {
        font-family: Courier , Courier New;
    }
    </style>
</head>
<body>
    <script type="text/javascript" src="./node_modules/requirejs/require.js"></script>
    <input id="tester" type="">
    <script type="text/javascript">
        window.onload = function () {
            require(['./src/Chuanr', './src/util', './src/shim/console'], function(Chuanr, util, console ){

                if ( typeof window.console == 'undefined') {
                    console = {};
                    console.log = function(){
                        var str = Array.prototype.slice.call(arguments).join(',');
                        var el = document.createTextNode(str);
                        document.body.appendChild(el);
                    };
                }

                var elInput = document.getElementById('tester');
                var chuanr = new Chuanr();
                chuanr.roast(elInput, [
                    "({11}) {99ddd}-{dddd}",
                    "({11}) {98ddd}-{dddd}",
                    "({11}) {97d(01234569)dd}-{dddd}",
                    "({11}) {96ddd}-{dddd}",
                    "({11}) {95ddd}-{dddd}",
                    "({dd}) {700d}-{dddd}",
                    "({dd}) {7010}-{dddd}",
                    "({dd}) {77dd}-{dddd}",
                    "({dd}) {78dd}-{dddd}",
                    "({dd}) {790d(124)}-{dddd}",
                    "({dd}) {791d(23456789)}-{dddd}",
                    "({dd}) {792d(03489)}-{dddd}",
                    "({dd}) {793d(012456789)}-{dddd}",
                    "({dd}) {794d}-{dddd}",
                    "({11}) {d(2345)ddd}-{dddd}"
                ]);
                chuanr.on('prevented', function() {
                    console.error('Prevented!!')
                })

                // for testing
                util.addListener(elInput, 'keydown', function(evt){
                    console.log('onkeydown: keyCode', evt.keyCode);
                });
                util.addListener(elInput, 'keypress', function(evt){
                    console.log('onkeypress: charCode', evt.charCode || evt.keyCode);
                });
                util.addListener(elInput, 'input', function(evt){
                    console.log('oninput "' + elInput.value + '"');
                });
                util.addListener(elInput, 'propertychange', function(evt){
                    console.log('onpropertychange', evt.charCode);
                });
                util.addListener(elInput, 'keyup', function(evt){
                    console.log('onkeyup "' + evt.keyCode + '"');
                });
                var MutationObserver = window.MutationObserver || window.webkitMutationObserver;
                if ( MutationObserver ) {
                    var observer = new MutationObserver(function(mutations){
                        console.log(11)
                        mutations.forEach(function(mutation){
                            console.log('Mutation: ' , mutation);
                        });
                    })
                    observer.observe(elInput, { attributes: true, childList: true, characterData: true, subtree: true, attributeOldValue: true });
                    // observer.disconnect();
                }
            });
        };
    </script>

</body>
</html>